# Agentic Mirror - 关键技术构成分析

> 版本: 1.0.0
> 日期: 2025-01-16
> 分析类型: 技术架构评估

---

## 执行摘要

### 技术栈全景图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                    Agentic Mirror 技术栈全景                                 │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 用户交互层                                                                   │
│ ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐    │
│ │ 触控屏    │ │ 语音交互  │ │ 手势识别  │ │ AR渲染   │ │ 补光控制  │    │
│ │ Qt/QML    │ │ Whisper   │ │ MediaPipe │ │ OpenGL ES│ │ PWM驱动   │    │
│ └───────────┘ └───────────┘ └───────────┘ └───────────┘ └───────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
┌─────────────────────────────────────────────────────────────────────────────┐
│ 边缘 AI 层                                                                   │
│ ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐    │
│ │ 人脸检测  │ │ 面部关键点│ │ 人脸追踪  │ │ 皮肤分析  │ │ 情绪识别  │    │
│ │ YOLOv8    │ │ MediaPipe │ │ DeepSORT  │ │ 轻量CNN   │ │ MobileNet │    │
│ └───────────┘ └───────────┘ └───────────┘ └───────────┘ └───────────┘    │
│                          RKNN Runtime (NPU 6 TOPS)                          │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
┌─────────────────────────────────────────────────────────────────────────────┐
│ 设备系统层                                                                   │
│ ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐    │
│ │ 摄像头    │ │ 云台控制  │ │ 网络通信  │ │ 存储管理  │ │ OTA升级   │    │
│ │ V4L2/ISP  │ │ STM32+PID │ │ WiFi6/BLE │ │ SQLite    │ │ A/B分区   │    │
│ └───────────┘ └───────────┘ └───────────┘ └───────────┘ └───────────┘    │
│                          Linux (Buildroot/Yocto)                            │
│                          RK3588 (Cortex-A76/A55 + Mali G610 + NPU)          │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
                              WebSocket/HTTPS
                                    │
┌─────────────────────────────────────────────────────────────────────────────┐
│ 云端 AI 层                                                                   │
│ ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐    │
│ │ 深度皮肤  │ │ 妆容推荐  │ │ 产品匹配  │ │ 潮流分析  │ │ LLM对话   │    │
│ │ 分析      │ │ 引擎      │ │ RecSys    │ │ NLP+CV    │ │ GPT/Claude│    │
│ └───────────┘ └───────────┘ └───────────┘ └───────────┘ └───────────┘    │
│                          PyTorch + CUDA (A100/H100)                         │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
┌─────────────────────────────────────────────────────────────────────────────┐
│ 云端服务层                                                                   │
│ ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐    │
│ │ API网关   │ │ 用户服务  │ │ 电商服务  │ │ 内容服务  │ │ 数据服务  │    │
│ │ Kong      │ │ FastAPI   │ │ FastAPI   │ │ FastAPI   │ │ Kafka     │    │
│ └───────────┘ └───────────┘ └───────────┘ └───────────┘ └───────────┘    │
│                          Kubernetes + Docker                                │
└─────────────────────────────────────────────────────────────────────────────┘
                                    │
┌─────────────────────────────────────────────────────────────────────────────┐
│ 数据存储层                                                                   │
│ ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐ ┌───────────┐    │
│ │ PostgreSQL│ │ Redis     │ │ MongoDB   │ │ Qdrant    │ │ S3/OSS    │    │
│ │ 结构化    │ │ 缓存/会话 │ │ 日志/行为 │ │ 向量搜索  │ │ 媒体文件  │    │
│ └───────────┘ └───────────┘ └───────────┘ └───────────┘ └───────────┘    │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 技术复杂度评估

| 技术领域 | 复杂度 | 成熟度 | 风险等级 | 关键挑战 |
|----------|--------|--------|----------|----------|
| 硬件系统 | ★★★★☆ | ★★★★☆ | 中 | 云台精度、散热 |
| 边缘 AI | ★★★★★ | ★★★☆☆ | 高 | 算力限制、模型优化 |
| 云端 AI | ★★★★☆ | ★★★★☆ | 中 | 推荐准确性、数据获取 |
| 嵌入式软件 | ★★★★☆ | ★★★★☆ | 中 | 实时性、稳定性 |
| 云端服务 | ★★★☆☆ | ★★★★★ | 低 | 常规技术栈 |

---

## 第一部分：硬件技术分析

### 1.1 主控平台选型

#### 1.1.1 方案对比

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          主控芯片方案对比                                    │
└─────────────────────────────────────────────────────────────────────────────┘

┌──────────────┬───────────────┬───────────────┬───────────────┬─────────────┐
│ 指标         │ RK3588        │ RK3568        │ 全志 H618     │ MTK Genio   │
│              │ (推荐)        │ (备选)        │ (低成本)      │ (高端备选)  │
├──────────────┼───────────────┼───────────────┼───────────────┼─────────────┤
│ CPU          │ 4xA76+4xA55   │ 4xA55         │ 4xA53         │ 4xA78+4xA55 │
│              │ 2.4GHz        │ 2.0GHz        │ 1.5GHz        │ 2.2GHz      │
├──────────────┼───────────────┼───────────────┼───────────────┼─────────────┤
│ GPU          │ Mali-G610 MP4 │ Mali-G52      │ Mali-G31      │ Mali-G78    │
├──────────────┼───────────────┼───────────────┼───────────────┼─────────────┤
│ NPU          │ 6 TOPS        │ 1 TOPS        │ 无            │ 4.8 TOPS    │
├──────────────┼───────────────┼───────────────┼───────────────┼─────────────┤
│ 内存支持     │ LPDDR4x/5     │ LPDDR4        │ LPDDR4        │ LPDDR5      │
│              │ 最大 32GB     │ 最大 8GB      │ 最大 4GB      │ 最大 16GB   │
├──────────────┼───────────────┼───────────────┼───────────────┼─────────────┤
│ 摄像头接口   │ 4x MIPI CSI   │ 2x MIPI CSI   │ 1x MIPI CSI   │ 4x MIPI CSI │
├──────────────┼───────────────┼───────────────┼───────────────┼─────────────┤
│ 显示接口     │ 2x MIPI DSI   │ 1x MIPI DSI   │ 1x MIPI DSI   │ 2x MIPI DSI │
│              │ + HDMI 2.1    │ + HDMI 2.0    │ + HDMI 2.0    │ + HDMI 2.1  │
├──────────────┼───────────────┼───────────────┼───────────────┼─────────────┤
│ 视频编码     │ 8K@30fps      │ 4K@60fps      │ 4K@30fps      │ 4K@60fps    │
├──────────────┼───────────────┼───────────────┼───────────────┼─────────────┤
│ 功耗         │ 5-10W         │ 3-5W          │ 2-3W          │ 5-8W        │
├──────────────┼───────────────┼───────────────┼───────────────┼─────────────┤
│ 单价 (量产)  │ ¥200-250      │ ¥80-100       │ ¥40-50        │ ¥300-400    │
├──────────────┼───────────────┼───────────────┼───────────────┼─────────────┤
│ 生态成熟度   │ ★★★★☆        │ ★★★★★        │ ★★★☆☆        │ ★★★☆☆      │
├──────────────┼───────────────┼───────────────┼───────────────┼─────────────┤
│ 适用场景     │ 推荐方案      │ 成本敏感      │ 极简版        │ 高端专业版  │
└──────────────┴───────────────┴───────────────┴───────────────┴─────────────┘

选型建议: RK3588
├── 理由 1: 6 TOPS NPU 满足边缘 AI 需求
├── 理由 2: 多路 MIPI CSI 支持多摄像头
├── 理由 3: 生态成熟，开发资源丰富
└── 风险: 功耗较高，需注意散热设计
```

#### 1.1.2 RK3588 技术细节

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          RK3588 芯片架构                                     │
└─────────────────────────────────────────────────────────────────────────────┘

                    ┌─────────────────────────────────────┐
                    │            RK3588 SoC               │
                    └─────────────────────────────────────┘
                                     │
        ┌────────────────────────────┼────────────────────────────┐
        │                            │                            │
        ▼                            ▼                            ▼
┌───────────────┐          ┌───────────────┐          ┌───────────────┐
│   CPU 集群    │          │   GPU + NPU   │          │   多媒体引擎  │
│               │          │               │          │               │
│ 4x Cortex-A76 │          │ Mali-G610 MP4 │          │ VPU (8K)      │
│ @ 2.4GHz      │          │ OpenGL ES 3.2 │          │ ISP (48MP)    │
│ 高性能核心    │          │ Vulkan 1.2    │          │ RGA (2D加速)  │
│               │          │               │          │               │
│ 4x Cortex-A55 │          │ NPU 3核       │          │ HDMI 2.1      │
│ @ 1.8GHz      │          │ 6 TOPS INT8   │          │ 编解码器      │
│ 高效能核心    │          │ 3 TOPS FP16   │          │               │
└───────────────┘          └───────────────┘          └───────────────┘

NPU 详细规格:
├── 架构: 3 个独立 NPU 核心
├── 算力: 6 TOPS (INT8), 3 TOPS (FP16/BF16)
├── 支持框架: TensorFlow, PyTorch, ONNX, Caffe
├── 推理运行时: RKNN (Rockchip Neural Network)
├── 支持算子: Conv, Pool, FC, ReLU, Softmax, LSTM 等 80+
└── 内存带宽: 与系统共享 LPDDR5 带宽

推理能力评估:
┌────────────────────────┬──────────────┬──────────────────────────────────┐
│ 模型                   │ 推理延迟     │ 说明                             │
├────────────────────────┼──────────────┼──────────────────────────────────┤
│ YOLOv5s (640x640)      │ 8ms          │ 人脸检测，可达 120fps            │
│ YOLOv8n (640x640)      │ 12ms         │ 人脸检测，可达 80fps             │
│ MobileNetV2            │ 3ms          │ 分类/特征提取                    │
│ MediaPipe Face Mesh    │ 15ms         │ 468 关键点                       │
│ ResNet50               │ 25ms         │ 皮肤分析主干网络                 │
└────────────────────────┴──────────────┴──────────────────────────────────┘
```

### 1.2 摄像头技术分析

#### 1.2.1 摄像头模组选型

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          摄像头技术方案                                      │
└─────────────────────────────────────────────────────────────────────────────┘

1. RGB 主摄像头

   ┌────────────────────────────────────────────────────────────────────────┐
   │ 需求分析:                                                               │
   │ ├── 用途: 人脸检测、追踪、皮肤RGB分析、AR叠加                          │
   │ ├── 分辨率要求: 4K@30fps 或 1080P@60fps                                │
   │ ├── 对焦: 需要自动对焦 (用户距离 30-80cm 变化)                         │
   │ └── 色彩: 高色准 (AWB 准确，用于肤色分析)                              │
   └────────────────────────────────────────────────────────────────────────┘

   方案对比:
   ┌──────────────┬───────────────┬───────────────┬───────────────┐
   │ 传感器       │ IMX586        │ OV13850       │ IMX258        │
   │              │ (推荐)        │ (备选)        │ (成本优化)    │
   ├──────────────┼───────────────┼───────────────┼───────────────┤
   │ 像素         │ 48MP          │ 13MP          │ 13MP          │
   │ 光圈         │ f/1.8         │ f/2.0         │ f/2.2         │
   │ 对焦         │ PDAF          │ CDAF          │ CDAF          │
   │ 帧率         │ 4K@30/1080@60 │ 4K@30         │ 1080@30       │
   │ 单价         │ ¥80-100       │ ¥40-50        │ ¥25-30        │
   │ 适用         │ 旗舰版        │ 标准版        │ 入门版        │
   └──────────────┴───────────────┴───────────────┴───────────────┘

2. IR 红外摄像头

   ┌────────────────────────────────────────────────────────────────────────┐
   │ 需求分析:                                                               │
   │ ├── 用途: 皮下组织成像、血管/色素检测                                  │
   │ ├── 波长: 850nm (表层) + 940nm (深层)                                  │
   │ ├── 分辨率: VGA (640x480) 即可                                         │
   │ └── 帧率: 30fps+                                                        │
   └────────────────────────────────────────────────────────────────────────┘

   推荐传感器: OmniVision OV7251 (全局快门，红外优化)
   ├── 分辨率: 640x480
   ├── 帧率: 120fps
   ├── 波长响应: 850nm/940nm 敏感
   └── 单价: ¥30-40

3. ToF 深度传感器

   ┌────────────────────────────────────────────────────────────────────────┐
   │ 需求分析:                                                               │
   │ ├── 用途: 3D人脸建模、距离感知、手势识别                               │
   │ ├── 测距范围: 0.2m - 2m                                                │
   │ ├── 精度: ±1cm                                                          │
   │ └── 优先级: P2 (V2.0 再加入)                                            │
   └────────────────────────────────────────────────────────────────────────┘

   推荐方案: Infineon REAL3 或 Sony DepthSense
   └── 可在 MVP 阶段省略，用单目估算深度
```

#### 1.2.2 ISP 与图像处理

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          图像处理流水线                                      │
└─────────────────────────────────────────────────────────────────────────────┘

  摄像头传感器        RK3588 ISP           软件处理            AI 推理
       │                  │                   │                   │
       ▼                  ▼                   ▼                   ▼
┌─────────────┐    ┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│ RAW 数据    │    │ ISP 处理    │    │ 预处理      │    │ 模型推理    │
│             │    │             │    │             │    │             │
│ Bayer 格式  │───►│ - 去噪      │───►│ - Resize    │───►│ - 人脸检测  │
│ 48MP        │    │ - AWB       │    │ - 归一化    │    │ - 关键点    │
│             │    │ - AE        │    │ - 色彩空间  │    │ - 皮肤分析  │
│             │    │ - 锐化      │    │   转换      │    │             │
│             │    │ - 畸变校正  │    │             │    │             │
└─────────────┘    └─────────────┘    └─────────────┘    └─────────────┘

关键技术点:

1. 自动白平衡 (AWB) 校准
   ├── 问题: 肤色检测依赖准确的色彩还原
   ├── 方案: 使用标准色卡进行出厂校准
   └── 运行时: 结合补光灯色温动态调整

2. 多摄像头同步
   ├── 问题: RGB + IR 需要时间同步
   ├── 方案: 硬件触发同步 (通过 GPIO)
   └── 精度: < 1ms 同步误差

3. 低延迟通路
   ├── 目标: 摄像头到显示 < 100ms
   ├── 方案: Zero-copy 缓冲区，GPU 直接渲染
   └── 优化: 跳过不必要的图像编解码
```

### 1.3 云台追踪系统

#### 1.3.1 机械设计

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          云台机械设计                                        │
└─────────────────────────────────────────────────────────────────────────────┘

机械结构:
                     ┌─────────────────┐
                     │    摄像头模组   │
                     │    + 补光灯     │
                     └────────┬────────┘
                              │
                     ┌────────┴────────┐
                     │   俯仰轴 (Pitch)│
                     │   -15° ~ +30°   │
                     └────────┬────────┘
                              │
                     ┌────────┴────────┐
                     │   偏航轴 (Yaw)  │
                     │   -45° ~ +45°   │
                     └────────┬────────┘
                              │
                     ┌────────┴────────┐
                     │     固定底座    │
                     └─────────────────┘

关键参数:
┌────────────────────────┬──────────────────────────────────────────────────┐
│ 参数                   │ 规格                                             │
├────────────────────────┼──────────────────────────────────────────────────┤
│ 自由度                 │ 2轴 (Pitch + Yaw)，V2.0 可扩展为 3轴           │
├────────────────────────┼──────────────────────────────────────────────────┤
│ 角度范围 - 俯仰        │ -15° ~ +30° (45° 总范围)                        │
├────────────────────────┼──────────────────────────────────────────────────┤
│ 角度范围 - 偏航        │ -45° ~ +45° (90° 总范围)                        │
├────────────────────────┼──────────────────────────────────────────────────┤
│ 最大转速               │ 60°/s                                            │
├────────────────────────┼──────────────────────────────────────────────────┤
│ 定位精度               │ 0.1° (通过编码器反馈)                           │
├────────────────────────┼──────────────────────────────────────────────────┤
│ 负载能力               │ 最大 500g (摄像头+补光灯)                       │
├────────────────────────┼──────────────────────────────────────────────────┤
│ 噪音                   │ < 25dB (使用静音驱动)                           │
└────────────────────────┴──────────────────────────────────────────────────┘
```

#### 1.3.2 电机与驱动

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          云台驱动方案                                        │
└─────────────────────────────────────────────────────────────────────────────┘

方案对比:

┌──────────────┬───────────────────┬───────────────────┬───────────────────┐
│ 方案         │ 步进电机+驱动     │ 无刷电机+FOC      │ 舵机              │
├──────────────┼───────────────────┼───────────────────┼───────────────────┤
│ 精度         │ ★★★★★ (微步)     │ ★★★★☆            │ ★★★☆☆            │
├──────────────┼───────────────────┼───────────────────┼───────────────────┤
│ 扭矩         │ ★★★★☆            │ ★★★★★            │ ★★★☆☆            │
├──────────────┼───────────────────┼───────────────────┼───────────────────┤
│ 静音         │ ★★★★☆ (TMC静音)  │ ★★★★★            │ ★★☆☆☆ (抖动)     │
├──────────────┼───────────────────┼───────────────────┼───────────────────┤
│ 成本         │ ★★★★☆ (¥80/轴)   │ ★★★☆☆ (¥150/轴)  │ ★★★★★ (¥30/轴)   │
├──────────────┼───────────────────┼───────────────────┼───────────────────┤
│ 复杂度       │ ★★★★☆            │ ★★★☆☆            │ ★★★★★            │
├──────────────┼───────────────────┼───────────────────┼───────────────────┤
│ 推荐         │ ✓ MVP/V1.0       │ V2.0 高端版       │ ✗ 不推荐          │
└──────────────┴───────────────────┴───────────────────┴───────────────────┘

推荐方案: 42步进电机 + TMC2209 驱动

┌────────────────────────────────────────────────────────────────────────────┐
│ TMC2209 特性:                                                               │
│ ├── StealthChop2: 超静音模式 (几乎无声)                                    │
│ ├── 256 微步: 0.0035° 步进精度                                             │
│ ├── 电流可调: 最大 2A RMS                                                   │
│ ├── UART 配置: 可动态调整参数                                               │
│ └── 堵转检测: StallGuard4 检测异常                                          │
└────────────────────────────────────────────────────────────────────────────┘
```

#### 1.3.3 控制算法

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          云台追踪控制算法                                    │
└─────────────────────────────────────────────────────────────────────────────┘

控制系统框图:

  视觉输入                控制器                  执行器
     │                      │                      │
     ▼                      ▼                      ▼
┌─────────────┐      ┌─────────────┐      ┌─────────────┐
│ 人脸检测    │      │ PID 控制器  │      │ 步进电机    │
│             │      │             │      │             │
│ Face Bbox   │─────►│ 误差计算    │─────►│ 脉冲信号    │
│ (x,y,w,h)   │      │ PID 输出    │      │ 电机转动    │
│             │      │ 平滑滤波    │      │             │
└─────────────┘      └──────┬──────┘      └──────┬──────┘
                            │                     │
                            │    ┌───────────┐    │
                            └───►│ 编码器    │◄───┘
                                 │ 反馈      │
                                 └───────────┘

控制算法实现:

```python
class GimbalController:
    """云台追踪控制器"""

    def __init__(self):
        # PID 参数 (需根据实际调试)
        self.pid_yaw = PIDController(Kp=0.8, Ki=0.1, Kd=0.05)
        self.pid_pitch = PIDController(Kp=0.6, Ki=0.08, Kd=0.04)

        # 卡尔曼滤波器 (平滑抖动)
        self.kalman_yaw = KalmanFilter1D(Q=0.01, R=0.1)
        self.kalman_pitch = KalmanFilter1D(Q=0.01, R=0.1)

        # 速度限制
        self.max_speed = 60  # 度/秒
        self.acceleration = 120  # 度/秒²

    def update(self, face_center, frame_center, dt):
        """
        更新云台位置

        Args:
            face_center: (x, y) 人脸中心像素坐标
            frame_center: (x, y) 画面中心像素坐标
            dt: 时间间隔 (秒)
        """
        # 计算像素误差
        error_x = face_center[0] - frame_center[0]
        error_y = face_center[1] - frame_center[1]

        # 像素误差转换为角度误差 (假设 FOV 80°, 分辨率 1920x1080)
        # 每像素约 80/1920 = 0.042°
        error_yaw = error_x * 0.042
        error_pitch = error_y * 0.042

        # 卡尔曼滤波平滑
        error_yaw = self.kalman_yaw.update(error_yaw)
        error_pitch = self.kalman_pitch.update(error_pitch)

        # 死区处理 (小误差不响应，避免抖动)
        if abs(error_yaw) < 0.5:
            error_yaw = 0
        if abs(error_pitch) < 0.5:
            error_pitch = 0

        # PID 计算
        speed_yaw = self.pid_yaw.compute(error_yaw, dt)
        speed_pitch = self.pid_pitch.compute(error_pitch, dt)

        # 速度限幅
        speed_yaw = np.clip(speed_yaw, -self.max_speed, self.max_speed)
        speed_pitch = np.clip(speed_pitch, -self.max_speed, self.max_speed)

        # 加速度平滑
        speed_yaw = self.smooth_acceleration(speed_yaw, self.last_speed_yaw, dt)
        speed_pitch = self.smooth_acceleration(speed_pitch, self.last_speed_pitch, dt)

        return speed_yaw, speed_pitch
```

延迟分析:
┌────────────────────────┬──────────────────────────────────────────────────┐
│ 环节                   │ 延迟                                             │
├────────────────────────┼──────────────────────────────────────────────────┤
│ 图像采集               │ 16ms (60fps) / 33ms (30fps)                     │
├────────────────────────┼──────────────────────────────────────────────────┤
│ 人脸检测               │ 10-15ms (NPU)                                    │
├────────────────────────┼──────────────────────────────────────────────────┤
│ 控制计算               │ < 1ms                                            │
├────────────────────────┼──────────────────────────────────────────────────┤
│ 通信延迟               │ < 1ms (UART/I2C)                                 │
├────────────────────────┼──────────────────────────────────────────────────┤
│ 电机响应               │ 10-20ms                                          │
├────────────────────────┼──────────────────────────────────────────────────┤
│ **总延迟**             │ **40-70ms** (满足 <100ms 目标)                  │
└────────────────────────┴──────────────────────────────────────────────────┘
```

### 1.4 补光系统

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          补光系统设计                                        │
└─────────────────────────────────────────────────────────────────────────────┘

LED 环形灯设计:

         ┌─────────────────────────────────────────┐
         │                                         │
         │      ○ ○ ○ ○ ○ ○ ○ ○ ○ ○ ○            │
         │    ○                       ○           │
         │   ○    ┌───────────────┐    ○          │
         │  ○     │               │     ○         │
         │  ○     │   摄像头区域  │     ○         │  <- 环形 LED 布局
         │  ○     │               │     ○         │
         │   ○    └───────────────┘    ○          │
         │    ○                       ○           │
         │      ○ ○ ○ ○ ○ ○ ○ ○ ○ ○ ○            │
         │                                         │
         └─────────────────────────────────────────┘

技术规格:
├── LED 类型: 高显色 SMD LED (CRI > 95)
├── 数量: 60 暖白 (3000K) + 60 冷白 (6500K) = 120 颗
├── 功率: 最大 15W
├── 色温范围: 2700K - 6500K 无极调节
├── 亮度: 10 级可调 (0-100%)
├── 驱动方式: PWM 调光 (1kHz)
└── 控制芯片: TLC5940 (16通道 PWM)

混色算法:
```python
def set_color_temperature(target_kelvin, brightness):
    """
    设置色温和亮度

    Args:
        target_kelvin: 目标色温 (2700-6500K)
        brightness: 亮度 (0-100%)
    """
    # 线性插值计算冷暖比例
    warm_ratio = (6500 - target_kelvin) / (6500 - 2700)
    cool_ratio = 1 - warm_ratio

    # 应用亮度
    warm_pwm = int(warm_ratio * brightness * 2.55)  # 0-255
    cool_pwm = int(cool_ratio * brightness * 2.55)

    # 设置 PWM
    set_warm_leds(warm_pwm)
    set_cool_leds(cool_pwm)
```

场景预设:
┌────────────────────────┬────────────┬────────────┬──────────────────────────┐
│ 模式                   │ 色温       │ 亮度       │ 用途                     │
├────────────────────────┼────────────┼────────────┼──────────────────────────┤
│ 日光模式               │ 5600K      │ 80%        │ 日常化妆，色彩准确       │
│ 暖光模式               │ 3200K      │ 70%        │ 晚宴/约会场景预览        │
│ 冷光模式               │ 6500K      │ 90%        │ 皮肤分析，细节清晰       │
│ 办公室模式             │ 4000K      │ 60%        │ 模拟办公室灯光           │
│ 自拍模式               │ 4500K      │ 100%       │ 拍照最佳光线             │
└────────────────────────┴────────────┴────────────┴──────────────────────────┘
```

---

## 第二部分：边缘 AI 技术分析

### 2.1 AI 模型架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          边缘 AI 模型栈                                      │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 实时流水线 (30fps)                                                           │
│                                                                              │
│  ┌───────────┐   ┌───────────┐   ┌───────────┐   ┌───────────┐            │
│  │ 人脸检测  │──►│ 人脸追踪  │──►│ 关键点    │──►│ 云台控制  │            │
│  │ YOLOv8n   │   │ DeepSORT  │   │ MediaPipe │   │ PID       │            │
│  │ 10ms      │   │ 2ms       │   │ 15ms      │   │ <1ms      │            │
│  └───────────┘   └───────────┘   └───────────┘   └───────────┘            │
│                                                                              │
│  总延迟: ~28ms (可达 35fps)                                                 │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│ 触发式分析 (按需执行)                                                        │
│                                                                              │
│  ┌───────────┐   ┌───────────┐   ┌───────────┐                             │
│  │ 皮肤分析  │   │ 情绪识别  │   │ 手势识别  │                             │
│  │ SkinNet   │   │ EmotionNet│   │ HandPose  │                             │
│  │ 80ms      │   │ 30ms      │   │ 25ms      │                             │
│  └───────────┘   └───────────┘   └───────────┘                             │
│                                                                              │
│  触发条件: 用户请求 / 定时任务 / 场景触发                                   │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 2.2 人脸检测与追踪

#### 2.2.1 YOLOv8-Face

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          YOLOv8-Face 模型                                    │
└─────────────────────────────────────────────────────────────────────────────┘

模型配置:
├── 基础模型: YOLOv8n (Nano 版本)
├── 输入尺寸: 640 × 640
├── 输出: 边界框 + 5点关键点 + 置信度
├── 模型大小: 6.3 MB (FP32), 1.8 MB (INT8)
└── 推理精度: INT8 量化

性能指标:
┌────────────────────────┬──────────────────────────────────────────────────┐
│ 指标                   │ 数值                                             │
├────────────────────────┼──────────────────────────────────────────────────┤
│ mAP@0.5 (WiderFace)    │ 94.3%                                            │
│ 推理延迟 (RK3588 NPU)  │ 8-12ms                                           │
│ 可处理帧率             │ 80-120 fps                                       │
│ 最小检测人脸           │ 32×32 像素                                       │
│ 多人检测               │ 支持 (最多 20 人)                                │
└────────────────────────┴──────────────────────────────────────────────────┘

模型转换流程:
┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│  PyTorch (.pt)  ──►  ONNX (.onnx)  ──►  RKNN (.rknn)                        │
│                                                                              │
│  步骤:                                                                       │
│  1. torch.export() 导出 ONNX                                                │
│  2. rknn-toolkit2 转换为 RKNN                                               │
│  3. INT8 量化 (使用校准数据集)                                              │
│  4. 模型验证和性能测试                                                       │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

代码示例:
```python
from rknnlite.api import RKNNLite

class FaceDetector:
    def __init__(self, model_path):
        self.rknn = RKNNLite()
        self.rknn.load_rknn(model_path)
        self.rknn.init_runtime(core_mask=RKNNLite.NPU_CORE_0_1_2)  # 使用全部3个NPU核心

    def detect(self, image):
        """
        检测人脸

        Args:
            image: BGR 图像 (H, W, 3)
        Returns:
            faces: [(x1, y1, x2, y2, conf, landmarks), ...]
        """
        # 预处理
        input_tensor = self.preprocess(image)

        # 推理
        outputs = self.rknn.inference(inputs=[input_tensor])

        # 后处理 (NMS + 解码)
        faces = self.postprocess(outputs, conf_thresh=0.5, iou_thresh=0.45)

        return faces
```

#### 2.2.2 DeepSORT 追踪

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          DeepSORT 追踪器                                     │
└─────────────────────────────────────────────────────────────────────────────┘

算法流程:
                    ┌─────────────┐
                    │ 检测结果    │
                    │ (Bboxes)    │
                    └──────┬──────┘
                           │
         ┌─────────────────┴─────────────────┐
         │                                   │
         ▼                                   ▼
┌─────────────┐                    ┌─────────────┐
│ ReID 特征   │                    │ 卡尔曼预测  │
│ 提取        │                    │             │
└──────┬──────┘                    └──────┬──────┘
       │                                  │
       └──────────────┬───────────────────┘
                      │
               ┌──────▼──────┐
               │ 匈牙利匹配  │
               │ (级联匹配)  │
               └──────┬──────┘
                      │
         ┌────────────┼────────────┐
         │            │            │
         ▼            ▼            ▼
┌─────────────┐ ┌─────────────┐ ┌─────────────┐
│ 匹配成功    │ │ 新建轨迹    │ │ 删除轨迹    │
│ 更新轨迹    │ │ (新检测)    │ │ (丢失)      │
└─────────────┘ └─────────────┘ └─────────────┘

ReID 特征提取:
├── 模型: MobileNetV2 (裁剪版)
├── 输出: 128 维特征向量
├── 推理时间: 3ms (单人脸)
└── 用途: 跨帧人脸匹配

性能优化:
├── 使用轻量级 ReID 模型
├── 仅对丢失目标进行 ReID
├── 卡尔曼滤波减少计算
└── 批量推理多个人脸
```

### 2.3 皮肤分析模型

#### 2.3.1 模型架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          皮肤分析模型架构                                    │
└─────────────────────────────────────────────────────────────────────────────┘

SkinAnalysisNet 架构:

  输入层                  主干网络                  多任务头
     │                       │                        │
     ▼                       ▼                        ▼
┌─────────────┐       ┌─────────────┐       ┌─────────────────────────────┐
│ RGB Image   │       │ EfficientNet│       │ 任务 1: 肤质分类            │
│ 256×256×3   │──────►│ B0/B2       │──────►│ FC → Softmax (干/中/油)    │
└─────────────┘       │             │       └─────────────────────────────┘
                      │ 特征金字塔  │       ┌─────────────────────────────┐
┌─────────────┐       │             │──────►│ 任务 2: 肤色回归            │
│ IR Image    │──────►│             │       │ FC → Sigmoid (Monk 1-10)   │
│ 256×256×1   │       │             │       └─────────────────────────────┘
└─────────────┘       └─────────────┘       ┌─────────────────────────────┐
                                            │ 任务 3: 问题检测            │
                                      ──────►│ FC → Sigmoid (多标签)      │
                                            │ [毛孔,黑头,痘痘,色斑,皱纹]  │
                                            └─────────────────────────────┘
                                            ┌─────────────────────────────┐
                                            │ 任务 4: 区域分割 (可选)     │
                                      ──────►│ Decoder → 语义分割         │
                                            │ [额头,眼周,鼻子,脸颊,下巴]  │
                                            └─────────────────────────────┘

模型规格:
┌────────────────────────┬──────────────────────────────────────────────────┐
│ 参数                   │ 边缘版本                │ 云端版本               │
├────────────────────────┼──────────────────────────────────────────────────┤
│ 主干网络               │ EfficientNet-B0         │ EfficientNet-B4       │
│ 参数量                 │ 5.3M                    │ 19M                   │
│ 输入尺寸               │ 256×256                 │ 512×512               │
│ 推理时间               │ 50-80ms (NPU)           │ 30-50ms (GPU)         │
│ 精度 (验证集)          │ 82%                     │ 91%                   │
│ 量化                   │ INT8                    │ FP16                  │
└────────────────────────┴──────────────────────────────────────────────────┘
```

#### 2.3.2 训练数据需求

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          训练数据需求                                        │
└─────────────────────────────────────────────────────────────────────────────┘

数据集构建:

1. 公开数据集
   ├── FFHQ (Flickr-Faces-HQ): 70,000 张高清人脸
   ├── CelebA: 200,000+ 张名人脸
   ├── ISIC (皮肤病变): 25,000+ 张 (用于迁移学习)
   └── Fitzpatrick17k: 17,000 张多肤色标注

2. 自建数据集 (关键)
   ├── 规模: 50,000+ 张
   ├── 采集: 真实用户授权采集
   ├── 标注: 皮肤科医生/专业美容师
   ├── 维度:
   │   ├── 肤质 (干/中/油/混合)
   │   ├── 肤色 (Monk Scale 1-10)
   │   ├── 问题标注 (边界框/分割)
   │   └── 严重程度 (1-5级)
   └── 成本估算: ¥50-100万 (采集+标注)

3. 数据增强
   ├── 几何变换: 旋转、翻转、缩放
   ├── 色彩变换: 亮度、对比度、饱和度
   ├── 光照模拟: 不同色温、方向光
   └── 合成数据: GAN 生成少数类样本

数据质量要求:
┌────────────────────────┬──────────────────────────────────────────────────┐
│ 要求                   │ 标准                                             │
├────────────────────────┼──────────────────────────────────────────────────┤
│ 分辨率                 │ ≥ 512×512                                       │
│ 光照一致性             │ 标准化补光条件                                   │
│ 肤色多样性             │ Monk Scale 各级别占比均衡                        │
│ 年龄分布               │ 18-60 岁均匀分布                                │
│ 性别比例               │ 女性 80%, 男性 20%                              │
│ 标注一致性             │ 双人标注，一致性 >85%                           │
└────────────────────────┴──────────────────────────────────────────────────┘
```

### 2.4 NPU 资源调度

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          NPU 资源调度策略                                    │
└─────────────────────────────────────────────────────────────────────────────┘

RK3588 NPU 资源分配:

  NPU Core 0 (2 TOPS)     NPU Core 1 (2 TOPS)     NPU Core 2 (2 TOPS)
        │                       │                       │
        ▼                       ▼                       ▼
┌───────────────┐       ┌───────────────┐       ┌───────────────┐
│ 人脸检测      │       │ 人脸检测      │       │ 皮肤分析      │
│ YOLOv8        │       │ (负载均衡)    │       │ SkinNet       │
│               │       │               │       │               │
│ 关键点检测    │       │ 情绪识别      │       │ (按需触发)    │
│ MediaPipe     │       │ EmotionNet    │       │               │
└───────────────┘       └───────────────┘       └───────────────┘

调度策略:

```python
class NPUScheduler:
    """NPU 任务调度器"""

    def __init__(self):
        self.core_status = [False, False, False]  # 核心占用状态
        self.task_queue = PriorityQueue()

        # 任务优先级定义
        self.priority = {
            'face_detection': 1,    # 最高优先级
            'face_tracking': 2,
            'landmark': 3,
            'skin_analysis': 4,
            'emotion': 5,
        }

    def schedule(self, task_name):
        """
        调度任务到可用 NPU 核心
        """
        priority = self.priority[task_name]

        # 查找可用核心
        available_core = self.find_available_core()

        if available_core is not None:
            # 立即执行
            return self.execute(task_name, available_core)
        else:
            # 加入队列等待
            self.task_queue.put((priority, task_name))
            return None

    def find_available_core(self):
        """优先分配策略"""
        # 实时任务使用 Core 0, 1
        # 分析任务使用 Core 2
        for i, busy in enumerate(self.core_status):
            if not busy:
                return i
        return None
```

资源预算:
┌────────────────────────┬────────────┬────────────┬────────────────────────┐
│ 任务                   │ 占用核心   │ 占用时间   │ 帧率                   │
├────────────────────────┼────────────┼────────────┼────────────────────────┤
│ 人脸检测 (30fps)       │ 0.5 核     │ 10ms/帧    │ 连续运行               │
│ 关键点检测 (30fps)     │ 0.5 核     │ 15ms/帧    │ 连续运行               │
│ 追踪计算               │ CPU        │ 2ms/帧     │ 连续运行               │
│ 皮肤分析               │ 1 核       │ 80ms/次    │ 按需 (每秒 1 次)       │
│ 情绪识别               │ 0.3 核     │ 30ms/次    │ 按需 (每 5 秒 1 次)    │
├────────────────────────┼────────────┼────────────┼────────────────────────┤
│ 总计                   │ ~2.3 核    │ -          │ 剩余 0.7 核余量        │
└────────────────────────┴────────────┴────────────┴────────────────────────┘
```

---

## 第三部分：云端 AI 技术分析

### 3.1 深度皮肤分析

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          云端皮肤分析系统                                    │
└─────────────────────────────────────────────────────────────────────────────┘

边缘 vs 云端分工:

┌────────────────────────────────────────────────────────────────────────────┐
│ 边缘 (快速初筛)                    │ 云端 (深度分析)                       │
├────────────────────────────────────┼────────────────────────────────────────┤
│ ✓ 肤质大类 (干/中/油)             │ ✓ 肤质细分 (10 级)                    │
│ ✓ 肤色粗分 (3 级)                 │ ✓ 肤色精确 (Monk 10 级)               │
│ ✓ 明显问题检测                    │ ✓ 细微问题检测                        │
│ ✓ 实时反馈                        │ ✓ 皮下分析 (IR 图像)                  │
│                                    │ ✓ 历史趋势分析                        │
│                                    │ ✓ 专业报告生成                        │
├────────────────────────────────────┼────────────────────────────────────────┤
│ 延迟: <100ms                       │ 延迟: 2-5s                            │
│ 精度: 80%                          │ 精度: 92%+                            │
└────────────────────────────────────┴────────────────────────────────────────┘

云端模型架构:

┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│  输入: RGB (512×512) + IR (256×256) + 用户历史                             │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                    多模态融合网络                                      │  │
│  │                                                                        │  │
│  │  RGB Branch          IR Branch          History Branch                 │  │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                │  │
│  │  │EfficientNet │    │ ResNet18    │    │ Transformer │                │  │
│  │  │ B4          │    │             │    │ Encoder     │                │  │
│  │  └──────┬──────┘    └──────┬──────┘    └──────┬──────┘                │  │
│  │         │                  │                  │                        │  │
│  │         └──────────────────┼──────────────────┘                        │  │
│  │                            │                                           │  │
│  │                    ┌───────▼───────┐                                   │  │
│  │                    │  Cross-Attn   │                                   │  │
│  │                    │  Fusion       │                                   │  │
│  │                    └───────┬───────┘                                   │  │
│  │                            │                                           │  │
│  └────────────────────────────┼──────────────────────────────────────────┘  │
│                               │                                              │
│  ┌────────────────────────────┼──────────────────────────────────────────┐  │
│  │                            ▼                                           │  │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐     │  │
│  │  │ 肤质    │  │ 肤色    │  │ 水分    │  │ 油脂    │  │ 问题    │     │  │
│  │  │ 评估    │  │ 评估    │  │ 评估    │  │ 评估    │  │ 检测    │     │  │
│  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘     │  │
│  │                                                                        │  │
│  │                      多任务学习头                                      │  │
│  └────────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 妆容推荐引擎

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          妆容推荐系统架构                                    │
└─────────────────────────────────────────────────────────────────────────────┘

推荐系统架构:

  用户特征              内容特征              上下文特征
     │                     │                     │
     ▼                     ▼                     ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ 用户画像    │     │ 妆容库      │     │ 场景感知    │
│             │     │             │     │             │
│ - 皮肤数据  │     │ - 妆容标签  │     │ - 日历事件  │
│ - 偏好历史  │     │ - 教程内容  │     │ - 天气      │
│ - 购买记录  │     │ - 难度等级  │     │ - 时间      │
│ - 人口属性  │     │ - 适用场合  │     │ - 心情      │
│             │     │             │     │             │
└──────┬──────┘     └──────┬──────┘     └──────┬──────┘
       │                   │                   │
       └───────────────────┼───────────────────┘
                           │
                    ┌──────▼──────┐
                    │ Embedding   │
                    │ Layer       │
                    └──────┬──────┘
                           │
                    ┌──────▼──────┐
                    │ Two-Tower   │
                    │ Model       │
                    │             │
                    │ User Tower  │
                    │ Item Tower  │
                    └──────┬──────┘
                           │
         ┌─────────────────┼─────────────────┐
         │                 │                 │
         ▼                 ▼                 ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│ 召回        │     │ 精排        │     │ 重排        │
│             │     │             │     │             │
│ - 向量召回  │────►│ - 多目标    │────►│ - 多样性    │
│ - 规则召回  │     │   排序      │     │ - 新颖性    │
│ - 热门召回  │     │ - CTR 预估  │     │ - 商业权重  │
│             │     │             │     │             │
└─────────────┘     └─────────────┘     └─────────────┘

关键技术:

1. 双塔模型 (Two-Tower)
   ```python
   class TwoTowerModel(nn.Module):
       def __init__(self, user_dim, item_dim, embed_dim=128):
           super().__init__()
           self.user_tower = nn.Sequential(
               nn.Linear(user_dim, 256),
               nn.ReLU(),
               nn.Linear(256, embed_dim)
           )
           self.item_tower = nn.Sequential(
               nn.Linear(item_dim, 256),
               nn.ReLU(),
               nn.Linear(256, embed_dim)
           )

       def forward(self, user_features, item_features):
           user_embed = self.user_tower(user_features)
           item_embed = self.item_tower(item_features)
           # 内积计算相似度
           score = torch.sum(user_embed * item_embed, dim=-1)
           return score
   ```

2. 多目标排序
   ├── 目标 1: 点击率预估 (CTR)
   ├── 目标 2: 完成率预估 (教程完成)
   ├── 目标 3: 满意度预估 (用户反馈)
   └── 融合: 加权组合

3. 向量检索
   ├── 向量库: Qdrant / Milvus
   ├── 索引: HNSW (近似最近邻)
   ├── 延迟: <50ms (百万级库)
   └── 召回: Top-100 候选
```

### 3.3 潮流分析系统

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          潮流分析技术方案                                    │
└─────────────────────────────────────────────────────────────────────────────┘

数据获取方案 (合规优先):

┌────────────────────────────────────────────────────────────────────────────┐
│ 方案对比                                                                    │
├──────────────┬────────────┬────────────┬────────────┬────────────────────┤
│ 方案         │ 合规性     │ 数据质量   │ 成本       │ 推荐               │
├──────────────┼────────────┼────────────┼────────────┼────────────────────┤
│ 官方API      │ ★★★★★     │ ★★★★☆     │ ★★★☆☆     │ 优先               │
│ KOL合作      │ ★★★★★     │ ★★★★★     │ ★★☆☆☆     │ 推荐               │
│ 自建社区     │ ★★★★★     │ ★★★☆☆     │ ★★★★☆     │ 长期               │
│ 第三方数据   │ ★★★★☆     │ ★★★★☆     │ ★★★☆☆     │ 补充               │
│ 爬虫         │ ★☆☆☆☆     │ ★★★★★     │ ★★★★★     │ ✗ 不推荐          │
└──────────────┴────────────┴────────────┴────────────┴────────────────────┘

潮流分析 Pipeline:

  数据采集                 内容理解                  趋势分析
     │                        │                        │
     ▼                        ▼                        ▼
┌─────────────┐        ┌─────────────┐        ┌─────────────┐
│ 多源聚合    │        │ 多模态理解  │        │ 趋势挖掘    │
│             │        │             │        │             │
│ - 官方API  │───────►│ - 图像分类  │───────►│ - 热度计算  │
│ - KOL内容  │        │ - 视频理解  │        │ - 趋势检测  │
│ - UGC社区  │        │ - NLP分析   │        │ - 预测模型  │
│             │        │ - 标签提取  │        │             │
└─────────────┘        └─────────────┘        └─────────────┘

内容理解模型:

1. 妆容风格分类
   ├── 模型: ViT-B/16 (Vision Transformer)
   ├── 类别: 自然、韩系、欧美、复古、个性 等 20+ 类
   ├── 精度: 89%
   └── 输入: 妆容图片

2. 妆容元素检测
   ├── 模型: DETR (Detection Transformer)
   ├── 检测: 眼影颜色、唇色、腮红位置 等
   ├── 精度: mAP 0.75
   └── 输出: 元素+位置+颜色

3. 文本分析
   ├── 模型: BERT-wwm (中文)
   ├── 任务: 标签提取、情感分析、关键词
   └── 用途: 理解笔记内容

趋势预测:
```python
class TrendPredictor:
    """趋势预测模型"""

    def __init__(self):
        self.model = LSTMForecaster(
            input_size=32,      # 特征维度
            hidden_size=64,
            num_layers=2,
            output_size=7       # 预测7天
        )

    def predict_trend(self, trend_history, features):
        """
        预测趋势走向

        Args:
            trend_history: 过去30天热度时序
            features: 额外特征 (季节、节日、事件)
        Returns:
            next_7_days: 未来7天热度预测
            trend_label: 上升/下降/平稳
        """
        predictions = self.model(trend_history, features)

        # 趋势判断
        slope = np.polyfit(range(7), predictions, 1)[0]
        if slope > 0.1:
            trend_label = "上升"
        elif slope < -0.1:
            trend_label = "下降"
        else:
            trend_label = "平稳"

        return predictions, trend_label
```
```

### 3.4 LLM 集成

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          LLM 应用场景                                        │
└─────────────────────────────────────────────────────────────────────────────┘

LLM 使用场景:

┌────────────────────────┬────────────────────────────────────────────────────┐
│ 场景                   │ 技术方案                                           │
├────────────────────────┼────────────────────────────────────────────────────┤
│ 推荐理由生成           │ GPT-4 Turbo, 短文本生成                            │
│                        │ Prompt: 根据用户特征解释推荐原因                   │
├────────────────────────┼────────────────────────────────────────────────────┤
│ 教程脚本生成           │ Claude 3, 长文本结构化生成                         │
│                        │ Prompt: 生成分步教程文案                           │
├────────────────────────┼────────────────────────────────────────────────────┤
│ 用户对话               │ GPT-4, 多轮对话理解                                │
│                        │ System: 美妆顾问人设                               │
├────────────────────────┼────────────────────────────────────────────────────┤
│ 产品描述优化           │ Claude 3, 商品文案                                 │
│                        │ Prompt: 优化产品卖点描述                           │
├────────────────────────┼────────────────────────────────────────────────────┤
│ 意图识别               │ GPT-4 Function Calling                             │
│                        │ 识别用户意图并调用工具                             │
└────────────────────────┴────────────────────────────────────────────────────┘

成本控制:

┌────────────────────────────────────────────────────────────────────────────┐
│ LLM 调用成本估算 (月)                                                       │
├────────────────────────┬───────────────┬───────────────┬──────────────────┤
│ 场景                   │ 调用量/用户   │ Token/次      │ 成本估算         │
├────────────────────────┼───────────────┼───────────────┼──────────────────┤
│ 推荐理由               │ 10次/天       │ 200           │ $0.06/用户/月   │
│ 教程脚本               │ 2次/天        │ 500           │ $0.03/用户/月   │
│ 用户对话               │ 5次/天        │ 300           │ $0.045/用户/月  │
├────────────────────────┼───────────────┼───────────────┼──────────────────┤
│ 总计                   │ -             │ -             │ ~$0.14/用户/月  │
│ 10万用户               │ -             │ -             │ ~$14,000/月     │
└────────────────────────┴───────────────┴───────────────┴──────────────────┘

优化策略:
├── 缓存: 相似请求复用结果
├── 批处理: 合并多个请求
├── 降级: 非关键场景用小模型
└── 国产替代: 使用 Qwen/GLM 降低成本
```

---

## 第四部分：软件系统技术分析

### 4.1 嵌入式软件架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          嵌入式软件架构                                      │
└─────────────────────────────────────────────────────────────────────────────┘

系统架构:

┌─────────────────────────────────────────────────────────────────────────────┐
│                          Application Layer                                   │
│                                                                              │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐     │
│  │ 主界面   │  │ 皮肤分析 │  │ 妆容推荐 │  │ 教程播放 │  │ 购物模块 │     │
│  │ (Qt/QML) │  │          │  │          │  │          │  │          │     │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘     │
│                                                                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                          Service Layer                                       │
│                                                                              │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐     │
│  │ AI推理   │  │ 云台控制 │  │ 摄像头   │  │ 网络通信 │  │ 数据存储 │     │
│  │ Service  │  │ Service  │  │ Service  │  │ Service  │  │ Service  │     │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘     │
│                                                                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                          HAL (Hardware Abstraction Layer)                    │
│                                                                              │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐     │
│  │ V4L2     │  │ GPIO/PWM │  │ I2C/SPI  │  │ UART     │  │ NPU      │     │
│  │ Camera   │  │ LED/Motor│  │ Sensors  │  │ MCU通信  │  │ Runtime  │     │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘     │
│                                                                              │
├─────────────────────────────────────────────────────────────────────────────┤
│                          Linux Kernel (5.10+)                                │
│                          Buildroot / Yocto                                   │
└─────────────────────────────────────────────────────────────────────────────┘

技术选型:

┌────────────────────────┬──────────────────────────────────────────────────┐
│ 组件                   │ 技术选择                                         │
├────────────────────────┼──────────────────────────────────────────────────┤
│ 操作系统               │ Linux (Buildroot 定制)                           │
│ 内核版本               │ 5.10 LTS (Rockchip BSP)                         │
│ UI 框架                │ Qt 6.5 + QML                                    │
│ AI 推理                │ RKNN Runtime 1.5+                               │
│ 摄像头                 │ V4L2 + libcamera                                │
│ 图形渲染               │ OpenGL ES 3.2 + Vulkan                          │
│ 网络通信               │ libcurl + WebSocket (libwebsockets)             │
│ 数据库                 │ SQLite 3                                        │
│ 多媒体                 │ GStreamer 1.0                                   │
│ 编程语言               │ C++ 17 (核心) + Python (AI 脚本)               │
└────────────────────────┴──────────────────────────────────────────────────┘
```

### 4.2 云端服务架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          云端服务架构                                        │
└─────────────────────────────────────────────────────────────────────────────┘

微服务架构:

                         ┌─────────────────┐
                         │   API Gateway   │
                         │   (Kong)        │
                         └────────┬────────┘
                                  │
        ┌─────────────────────────┼─────────────────────────┐
        │                         │                         │
        ▼                         ▼                         ▼
┌───────────────┐       ┌───────────────┐       ┌───────────────┐
│ User Service  │       │ AI Service    │       │ Commerce      │
│               │       │               │       │ Service       │
│ - 认证/授权   │       │ - 皮肤分析    │       │ - 商品目录    │
│ - 用户画像    │       │ - 推荐引擎    │       │ - 订单管理    │
│ - 偏好设置    │       │ - 潮流分析    │       │ - 支付对接    │
│               │       │ - LLM 服务    │       │               │
│ FastAPI       │       │ FastAPI+GPU   │       │ FastAPI       │
└───────┬───────┘       └───────┬───────┘       └───────┬───────┘
        │                       │                       │
        └───────────────────────┼───────────────────────┘
                                │
        ┌───────────────────────┼───────────────────────┐
        │                       │                       │
        ▼                       ▼                       ▼
┌───────────────┐       ┌───────────────┐       ┌───────────────┐
│ PostgreSQL    │       │ Redis         │       │ Qdrant        │
│ (主数据库)    │       │ (缓存/会话)   │       │ (向量搜索)    │
└───────────────┘       └───────────────┘       └───────────────┘

技术栈:

┌────────────────────────┬──────────────────────────────────────────────────┐
│ 层级                   │ 技术选择                                         │
├────────────────────────┼──────────────────────────────────────────────────┤
│ API 网关               │ Kong / APISIX                                   │
│ Web 框架               │ FastAPI (Python 3.11+)                          │
│ 异步任务               │ Celery + Redis                                  │
│ 消息队列               │ Kafka / RabbitMQ                                │
│ 数据库                 │ PostgreSQL 15+                                  │
│ 缓存                   │ Redis 7+                                        │
│ 向量数据库             │ Qdrant / Milvus                                 │
│ 对象存储               │ MinIO / 阿里云 OSS                              │
│ AI 推理                │ PyTorch + Triton Inference Server              │
│ 容器编排               │ Kubernetes (K8s)                                │
│ CI/CD                  │ GitLab CI / GitHub Actions                      │
│ 监控                   │ Prometheus + Grafana                            │
│ 日志                   │ ELK Stack / Loki                                │
└────────────────────────┴──────────────────────────────────────────────────┘
```

---

## 第五部分：技术风险与缓解

### 5.1 技术风险矩阵

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          技术风险评估矩阵                                    │
└─────────────────────────────────────────────────────────────────────────────┘

                        影响程度
                   低      中      高
              ┌─────────────────────────┐
           高 │  R5     │  R2 R4  │  R1   │
    发   ─────┼─────────┼─────────┼───────┤
    生   中   │  R7     │  R3 R6  │  R8   │
    概   ─────┼─────────┼─────────┼───────┤
    率   低   │         │  R9     │  R10  │
              └─────────┴─────────┴───────┘

风险清单:

R1: 边缘 AI 精度不足 [高概率 × 高影响]
├── 描述: 皮肤分析准确率达不到预期
├── 缓解:
│   ├── 边缘做初筛，云端做精确分析
│   ├── 收集更多训练数据
│   └── 降低宣传预期
└── 备选: 纯云端方案 (牺牲响应速度)

R2: 云台噪音过大 [高概率 × 中影响]
├── 描述: 步进电机噪音影响使用体验
├── 缓解:
│   ├── 使用 TMC2209 静音驱动
│   ├── 限制最大转速
│   └── 增加减震设计
└── 备选: 无刷电机+FOC (成本增加)

R3: 散热问题 [中概率 × 中影响]
├── 描述: RK3588 发热导致降频
├── 缓解:
│   ├── 大面积散热片设计
│   ├── 动态功耗管理
│   └── 限制连续使用时长
└── 备选: 增加风扇 (影响静音)

R4: 供应链风险 [高概率 × 中影响]
├── 描述: 芯片/摄像头交期不稳定
├── 缓解:
│   ├── 提前 3 个月下单
│   ├── 多供应商备选
│   └── 安全库存
└── 备选: 使用替代芯片方案

R5: 模型更新困难 [高概率 × 低影响]
├── 描述: OTA 模型更新失败/回滚
├── 缓解:
│   ├── A/B 分区设计
│   ├── 增量更新
│   └── 版本回滚机制
└── 备选: 云端推理 (不依赖本地模型)

R6: 数据合规风险 [中概率 × 中影响]
├── 描述: 社交媒体数据获取违规
├── 缓解:
│   ├── 只用官方 API
│   ├── 自建内容社区
│   └── 法务合规审查
└── 备选: 人工编辑内容

R7: 开发周期延长 [中概率 × 低影响]
├── 描述: 技术复杂度导致延期
├── 缓解:
│   ├── MVP 功能精简
│   ├── 增加 buffer 时间
│   └── 外包非核心模块
└── 备选: 分阶段发布

R8: 安全漏洞 [中概率 × 高影响]
├── 描述: 设备被入侵，数据泄露
├── 缓解:
│   ├── 安全设计评审
│   ├── 渗透测试
│   └── 数据加密存储
└── 备选: 增加安全团队投入

R9: AR 效果不佳 [低概率 × 中影响]
├── 描述: AR 试妆与真实差距大
├── 缓解:
│   ├── 迭代优化渲染效果
│   ├── 定位为"预览"功能
│   └── V2.0 再完善
└── 备选: 暂不上线 AR 功能

R10: 竞品快速跟进 [低概率 × 高影响]
├── 描述: 大厂推出类似产品
├── 缓解:
│   ├── 加快迭代速度
│   ├── 建立专利保护
│   └── 积累数据壁垒
└── 备选: 差异化定位
```

---

## 第六部分：技术路线图与团队

### 6.1 技术开发路线图

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          技术开发路线图                                      │
└─────────────────────────────────────────────────────────────────────────────┘

                2025                           2026
    Q1    Q2    Q3    Q4    Q1    Q2    Q3    Q4
    │     │     │     │     │     │     │     │

硬件开发
    ├─────┤ 原型机开发
          ├─────┤ EVT (工程验证)
                ├─────┤ DVT (设计验证)
                      ├─────┤ PVT (量产验证)
                            ├─────────────────► 量产

边缘AI
    ├─────┤ 模型选型+优化
          ├─────────────┤ 模型训练+部署
                        ├─────────────────────► 持续优化

云端AI
          ├─────┤ 推荐系统 V1
                ├─────┤ 潮流分析
                      ├─────────────────────► 完善迭代

嵌入式软件
    ├───────────┤ 核心功能开发
                ├─────┤ 系统优化
                      ├─────────────────────► 功能迭代

云端服务
          ├─────────────┤ 服务开发
                        ├───────────────────► 扩展迭代

关键里程碑:
├── M1 (2025.Q1): 原型机完成，核心功能可演示
├── M2 (2025.Q2): EVT 完成，软件功能完整
├── M3 (2025.Q3): DVT 完成，准备量产
├── M4 (2025.Q4): PVT 完成，小批量试产
├── M5 (2026.Q1): 正式量产，产品上市
└── M6 (2026.Q3): V2.0 发布，功能升级
```

### 6.2 技术团队配置

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          技术团队配置                                        │
└─────────────────────────────────────────────────────────────────────────────┘

Phase 1 团队 (12人):

┌─────────────────────────────────────────────────────────────────────────────┐
│                                                                              │
│  技术负责人 (1人)                                                           │
│  └── 要求: 10年+经验，AI+嵌入式背景，有量产经验                            │
│                                                                              │
│  ┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐             │
│  │   硬件组 (3人)  │  │   嵌入式组 (4人) │  │   AI 组 (3人)  │             │
│  │                 │  │                  │  │                │             │
│  │ - 硬件工程师   │  │ - 嵌入式架构师  │  │ - AI 算法负责人│             │
│  │ - 结构工程师   │  │ - 系统工程师    │  │ - CV 算法工程师│             │
│  │ - 电子工程师   │  │ - Qt/QML 开发   │  │ - 推荐算法工程师│            │
│  │                 │  │ - 驱动开发      │  │                │             │
│  └─────────────────┘  └─────────────────┘  └─────────────────┘             │
│                                                                              │
│  测试 (1人)                                                                 │
│  └── 自动化测试 + 硬件测试                                                 │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

关键岗位 JD:

1. 边缘 AI 算法工程师
   ├── 要求:
   │   ├── 3年+ CV/AI 经验
   │   ├── 熟悉模型量化、剪枝、蒸馏
   │   ├── 有边缘部署经验 (RKNN/TensorRT)
   │   └── 熟悉人脸检测/关键点/皮肤分析任一领域
   └── 难度: ★★★★★ (极难招聘)

2. 嵌入式系统架构师
   ├── 要求:
   │   ├── 5年+ 嵌入式 Linux 经验
   │   ├── 熟悉 ARM 架构，有 Rockchip 经验优先
   │   ├── 精通 C/C++，熟悉 Qt
   │   └── 有消费电子产品量产经验
   └── 难度: ★★★★☆ (难招聘)

3. 云台控制工程师
   ├── 要求:
   │   ├── 3年+ 运动控制经验
   │   ├── 熟悉步进电机/无刷电机控制
   │   ├── 精通 PID/模糊控制/卡尔曼滤波
   │   └── 有云台/机器人经验优先
   └── 难度: ★★★☆☆ (中等难度)

成本估算:
┌────────────────────────┬────────────────────────────────────────────────────┐
│ 岗位                   │ 年薪范围 (税前)                                    │
├────────────────────────┼────────────────────────────────────────────────────┤
│ 技术负责人             │ ¥100-150万                                         │
│ 高级工程师             │ ¥50-80万                                           │
│ 中级工程师             │ ¥30-50万                                           │
├────────────────────────┼────────────────────────────────────────────────────┤
│ 团队总成本 (12人)      │ ~¥600万/年                                        │
└────────────────────────┴────────────────────────────────────────────────────┘
```

---

## 总结：关键技术评估

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          关键技术总结                                        │
└─────────────────────────────────────────────────────────────────────────────┘

技术可行性评分:

┌────────────────────────┬────────────┬────────────┬────────────┬────────────┐
│ 技术模块               │ 成熟度     │ 难度       │ 风险       │ 可行性     │
├────────────────────────┼────────────┼────────────┼────────────┼────────────┤
│ 主控系统 (RK3588)      │ ★★★★☆    │ ★★★☆☆    │ ★★☆☆☆    │ ✅ 高      │
│ 摄像头系统             │ ★★★★★    │ ★★☆☆☆    │ ★★☆☆☆    │ ✅ 高      │
│ 云台追踪               │ ★★★★☆    │ ★★★★☆    │ ★★★☆☆    │ ✅ 中高    │
│ 补光系统               │ ★★★★★    │ ★★☆☆☆    │ ★☆☆☆☆    │ ✅ 高      │
│ 人脸检测/追踪          │ ★★★★★    │ ★★☆☆☆    │ ★☆☆☆☆    │ ✅ 高      │
│ 皮肤分析 (边缘)        │ ★★★☆☆    │ ★★★★☆    │ ★★★★☆    │ ⚠️ 中      │
│ 皮肤分析 (云端)        │ ★★★★☆    │ ★★★☆☆    │ ★★★☆☆    │ ✅ 中高    │
│ 妆容推荐               │ ★★★☆☆    │ ★★★★☆    │ ★★★☆☆    │ ⚠️ 中      │
│ AR 试妆                │ ★★★★☆    │ ★★★☆☆    │ ★★☆☆☆    │ ✅ 中高    │
│ 潮流分析               │ ★★☆☆☆    │ ★★★★☆    │ ★★★★☆    │ ⚠️ 中低    │
│ 云端服务               │ ★★★★★    │ ★★☆☆☆    │ ★☆☆☆☆    │ ✅ 高      │
└────────────────────────┴────────────┴────────────┴────────────┴────────────┘

核心技术挑战 (Top 3):

1. 边缘皮肤分析精度
   ├── 挑战: 有限算力下达到高精度
   ├── 策略: 边缘初筛 + 云端精分析
   └── 投入: 需要 3+ 人月 + 大量数据

2. 妆容推荐准确性
   ├── 挑战: 冷启动问题 + 主观审美
   ├── 策略: 多策略召回 + 快速反馈学习
   └── 投入: 需要 6+ 人月 + 持续迭代

3. 潮流数据获取
   ├── 挑战: 合规获取社交媒体数据
   ├── 策略: 官方API + KOL合作 + 自建社区
   └── 投入: 需要商务 + 内容运营团队

建议:
├── MVP 阶段聚焦成熟技术，降低风险
├── 核心创新点 (推荐+电商) 持续投入
├── 组建边缘AI专项团队，这是技术壁垒
└── 预留 20% 技术 buffer 应对不确定性
```

---

*技术分析完成，建议每季度更新评估*
