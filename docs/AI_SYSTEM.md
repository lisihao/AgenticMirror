# Agentic Mirror - AI 系统设计文档

> 版本: 1.0.0
> 日期: 2025-01-16

---

## 一、AI 系统概述

### 1.1 设计理念

Agentic Mirror 的 AI 系统采用 **边云协同** 架构，在设备端进行实时感知和基础推理，在云端进行深度分析和复杂推荐。

### 1.2 AI 能力矩阵

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          AI 能力全景图                                       │
└─────────────────────────────────────────────────────────────────────────────┘

  感知层                    理解层                    决策层
    │                        │                        │
    ▼                        ▼                        ▼
┌─────────┐            ┌─────────┐            ┌─────────┐
│ 视觉AI  │            │ 分析AI  │            │ 推荐AI  │
│         │            │         │            │         │
│-人脸检测│ ────────►  │-皮肤评估│ ────────►  │-妆容推荐│
│-追踪定位│            │-肤色分析│            │-产品匹配│
│-表情识别│            │-问题诊断│            │-教程生成│
│-关键点  │            │-情绪理解│            │-趋势预测│
│         │            │         │            │         │
└─────────┘            └─────────┘            └─────────┘
    │                        │                        │
    │                        │                        │
    ▼                        ▼                        ▼
┌─────────────────────────────────────────────────────────────────────────────┐
│                              LLM 对话层                                      │
│                                                                              │
│  - 自然语言理解        - 推荐解释生成        - 教程脚本生成                 │
│  - 意图识别            - 个性化对话          - 问答交互                     │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 二、视觉 AI 模块

### 2.1 人脸检测与追踪

#### 2.1.1 模型选型

| 模型 | 用途 | 部署位置 | 精度 | 速度 |
|------|------|----------|------|------|
| YOLOv8-Face | 人脸检测 | Edge (NPU) | mAP 95% | 50fps |
| RetinaFace | 人脸检测 (备选) | Edge | mAP 96% | 30fps |
| DeepSORT | 多人追踪 | Edge (CPU) | MOTA 85% | 60fps |

#### 2.1.2 人脸检测流程

```
┌─────────────────────────────────────────────────────────────────┐
│                    人脸检测 Pipeline                             │
└─────────────────────────────────────────────────────────────────┘

  摄像头输入                    预处理                     推理
      │                          │                          │
      ▼                          ▼                          ▼
┌─────────────┐          ┌─────────────┐          ┌─────────────┐
│ RGB Frame   │          │ Resize      │          │ YOLOv8-Face │
│ 4K@30fps    │ ───────► │ 640x640     │ ───────► │ (RKNN NPU)  │
│             │          │ Normalize   │          │             │
└─────────────┘          └─────────────┘          └──────┬──────┘
                                                         │
                                                         ▼
  后处理                   NMS                      输出
      │                      │                        │
      ▼                      ▼                        ▼
┌─────────────┐          ┌─────────────┐          ┌─────────────┐
│ 人脸框      │          │ 非极大抑制  │          │ Face BBox   │
│ 置信度      │ ◄─────── │ threshold   │ ◄─────── │ Landmarks   │
│ 5点关键点   │          │ = 0.5       │          │ Confidence  │
└─────────────┘          └─────────────┘          └─────────────┘
```

#### 2.1.3 多人追踪算法

```python
class FaceTracker:
    """基于 DeepSORT 的人脸追踪器"""

    def __init__(self):
        self.max_age = 30  # 丢失目标保留帧数
        self.n_init = 3    # 确认目标最小检测次数
        self.tracks = {}
        self.next_id = 0

    def update(self, detections, features):
        """
        Args:
            detections: [(x1, y1, x2, y2, conf), ...]
            features: [embedding_128d, ...]
        Returns:
            tracks: [(track_id, x1, y1, x2, y2), ...]
        """
        # 1. 匈牙利匹配
        matches, unmatched_dets, unmatched_tracks = self._match(
            detections, features
        )

        # 2. 更新匹配的轨迹
        for track_id, det_idx in matches:
            self.tracks[track_id].update(detections[det_idx])

        # 3. 创建新轨迹
        for det_idx in unmatched_dets:
            self._create_track(detections[det_idx], features[det_idx])

        # 4. 删除丢失轨迹
        self._remove_lost_tracks()

        return self._get_active_tracks()
```

### 2.2 面部关键点检测

#### 2.2.1 MediaPipe Face Mesh

| 参数 | 规格 |
|------|------|
| 关键点数量 | 468 个 3D 点 |
| 精度 | 平均误差 < 2px |
| 速度 | 100fps (Edge) |
| 用途 | 脸型分析、AR 试妆 |

#### 2.2.2 关键点区域划分

```
                    ┌─────────────────────────────────────┐
                    │           面部关键点分区            │
                    └─────────────────────────────────────┘

                         ┌───────────────────┐
                         │     额头区域      │ ← 抬头纹检测
                         │   (30 landmarks)  │
                         └─────────┬─────────┘
                                   │
              ┌────────────────────┼────────────────────┐
              │                    │                    │
        ┌─────┴─────┐        ┌─────┴─────┐        ┌─────┴─────┐
        │  左眼区域  │        │  鼻子区域  │        │  右眼区域  │
        │ (33 pts)  │        │ (25 pts)  │        │ (33 pts)  │
        │           │        │           │        │           │
        │ - 眼袋    │        │ - 鼻型    │        │ - 黑眼圈  │
        │ - 鱼尾纹  │        │ - 毛孔    │        │ - 细纹    │
        └───────────┘        └───────────┘        └───────────┘
                                   │
                         ┌─────────┴─────────┐
                         │     面颊区域      │ ← 腮红定位
                         │   (45 pts x 2)   │
                         └─────────┬─────────┘
                                   │
                         ┌─────────┴─────────┐
                         │     嘴唇区域      │ ← 口红试色
                         │   (40 pts)       │
                         └─────────┬─────────┘
                                   │
                         ┌─────────┴─────────┐
                         │     下巴区域      │ ← 轮廓修容
                         │   (17 pts)       │
                         └─────────────────────┘
```

### 2.3 表情与情绪识别

#### 2.3.1 模型架构

| 模型 | 输入 | 输出 | 精度 |
|------|------|------|------|
| EmotionNet | 112x112 人脸图 | 7类情绪 + 置信度 | 78% (FER2013) |

#### 2.3.2 情绪类别

| 类别 | 应用场景 |
|------|----------|
| 高兴 (Happy) | 推荐活力妆 |
| 悲伤 (Sad) | 推荐提亮妆 |
| 愤怒 (Angry) | 推荐柔和妆 |
| 惊讶 (Surprise) | - |
| 恐惧 (Fear) | - |
| 厌恶 (Disgust) | - |
| 中性 (Neutral) | 常规推荐 |

---

## 三、皮肤分析模块

### 3.1 分析维度

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          皮肤分析维度                                        │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  基础指标                                                                    │
│                                                                              │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐          │
│  │ 肤质    │  │ 肤色    │  │ 水分    │  │ 油脂    │  │ 敏感度  │          │
│  │         │  │         │  │         │  │         │  │         │          │
│  │ 干/中/油│  │ Monk    │  │ 0-100   │  │ 0-100   │  │ 低/中/高│          │
│  │         │  │ Scale   │  │         │  │         │  │         │          │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘          │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  问题检测                                                                    │
│                                                                              │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐          │
│  │ 毛孔    │  │ 黑头    │  │ 痘痘    │  │ 色斑    │  │ 皱纹    │          │
│  │         │  │         │  │         │  │         │  │         │          │
│  │ 大小    │  │ 数量    │  │ 数量    │  │ 面积    │  │ 深度    │          │
│  │ 密度    │  │ 分布    │  │ 炎症度  │  │ 颜色    │  │ 长度    │          │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘          │
│                                                                              │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐                        │
│  │ 黑眼圈  │  │ 眼袋    │  │ 红血丝  │  │ 暗沉    │                        │
│  │         │  │         │  │         │  │         │                        │
│  │ 颜色    │  │ 程度    │  │ 分布    │  │ 区域    │                        │
│  │ 范围    │  │         │  │         │  │         │                        │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘                        │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 3.2 肤色分析 (Monk Skin Tone Scale)

采用 Google 推出的 10 级肤色标准，更具包容性：

| 级别 | 色值 (Hex) | 描述 |
|------|------------|------|
| 1 | #f6ede4 | 极浅肤色 |
| 2 | #f3e7db | 浅肤色 |
| 3 | #f7ead0 | 浅暖肤色 |
| 4 | #eadaba | 中浅肤色 |
| 5 | #d7bd96 | 中等肤色 |
| 6 | #a07e56 | 中深肤色 |
| 7 | #825c43 | 深肤色 |
| 8 | #604134 | 较深肤色 |
| 9 | #3a312a | 深棕肤色 |
| 10 | #292420 | 极深肤色 |

### 3.3 皮肤分析模型

#### 3.3.1 模型架构

```
┌─────────────────────────────────────────────────────────────────┐
│                    SkinAnalysisNet 架构                          │
└─────────────────────────────────────────────────────────────────┘

  输入                  Backbone                  多任务头
    │                      │                        │
    ▼                      ▼                        ▼
┌─────────┐          ┌─────────────┐          ┌─────────────┐
│ RGB     │          │ EfficientNet│          │ 肤质分类头  │
│ 512x512 │ ───────► │ B4          │ ───────► │ (干/中/油)  │
│         │          │             │          └─────────────┘
│ IR      │          │ Pretrained  │          ┌─────────────┐
│ 256x256 │ ───────► │ + Fine-tune │ ───────► │ 肤色回归头  │
│         │          │             │          │ (Monk 1-10) │
└─────────┘          └─────────────┘          └─────────────┘
                                              ┌─────────────┐
                                              │ 问题检测头  │
                                              │ (多标签)    │
                                              └─────────────┘
                                              ┌─────────────┐
                                              │ 区域分割头  │
                                              │ (语义分割)  │
                                              └─────────────┘
```

#### 3.3.2 训练数据

| 数据集 | 样本数 | 用途 |
|--------|--------|------|
| FFHQ | 70,000 | 预训练 |
| 自建皮肤数据集 | 50,000 | 皮肤分析 |
| 皮肤科临床数据 | 10,000 | 问题检测 |

### 3.4 IR 深层分析

利用红外摄像头进行皮下检测：

| 检测项 | 波长 | 原理 |
|--------|------|------|
| 隐藏色斑 | 850nm | 黑色素对近红外吸收 |
| 毛细血管 | 940nm | 血红蛋白吸收 |
| 皮下油脂 | 850nm | 油脂反射特性 |

---

## 四、推荐系统

### 4.1 推荐架构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          推荐系统架构                                        │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│                            数据输入层                                        │
│                                                                              │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐          │
│  │ 用户    │  │ 皮肤    │  │ 情绪    │  │ 日历    │  │ 潮流    │          │
│  │ 画像    │  │ 分析    │  │ 状态    │  │ 日程    │  │ 数据    │          │
│  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘  └────┬────┘          │
│       │            │            │            │            │                 │
│       └────────────┴────────────┴────────────┴────────────┘                 │
│                                 │                                            │
│                                 ▼                                            │
└─────────────────────────────────┬───────────────────────────────────────────┘
                                  │
┌─────────────────────────────────▼───────────────────────────────────────────┐
│                            特征融合层                                        │
│                                                                              │
│  ┌───────────────────────────────────────────────────────────────────────┐  │
│  │                    Multi-Modal Fusion Network                         │  │
│  │                                                                       │  │
│  │  User Embedding + Skin Features + Context Features + Trend Features  │  │
│  │                              ↓                                        │  │
│  │                    Attention-based Fusion                            │  │
│  │                              ↓                                        │  │
│  │                    User State Vector (512d)                          │  │
│  │                                                                       │  │
│  └───────────────────────────────────────────────────────────────────────┘  │
│                                                                              │
└─────────────────────────────────┬───────────────────────────────────────────┘
                                  │
┌─────────────────────────────────▼───────────────────────────────────────────┐
│                            推荐引擎层                                        │
│                                                                              │
│  ┌─────────────┐        ┌─────────────┐        ┌─────────────┐             │
│  │  妆容推荐   │        │  穿搭推荐   │        │  产品推荐   │             │
│  │             │        │             │        │             │             │
│  │ Makeup     │        │ Outfit     │        │ Product    │             │
│  │ Matching   │        │ Matching   │        │ Matching   │             │
│  │             │        │             │        │             │             │
│  └──────┬──────┘        └──────┬──────┘        └──────┬──────┘             │
│         │                      │                      │                     │
│         └──────────────────────┼──────────────────────┘                     │
│                                │                                            │
│                                ▼                                            │
│                    ┌─────────────────────┐                                  │
│                    │   Ranking Layer     │                                  │
│                    │                     │                                  │
│                    │ - 相关性排序        │                                  │
│                    │ - 多样性保证        │                                  │
│                    │ - 商业权重          │                                  │
│                    │                     │                                  │
│                    └─────────────────────┘                                  │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 4.2 妆容推荐

#### 4.2.1 妆容分类体系

```
妆容类型
├── 日常妆
│   ├── 通勤妆 (5min快速)
│   ├── 自然妆 (裸妆感)
│   └── 清透妆 (夏季)
│
├── 职场妆
│   ├── 干练妆
│   ├── 气质妆
│   └── 领导力妆
│
├── 约会妆
│   ├── 甜美妆
│   ├── 温柔妆
│   └── 性感妆
│
├── 派对妆
│   ├── 闪亮妆
│   ├── 烟熏妆
│   └── 复古妆
│
└── 特殊场合
    ├── 婚礼妆
    ├── 面试妆
    └── 年会妆
```

#### 4.2.2 妆容匹配算法

```python
class MakeupRecommender:
    """妆容推荐引擎"""

    def recommend(self, user_state: UserState) -> List[MakeupStyle]:
        """
        Args:
            user_state: 用户当前状态 (皮肤、情绪、日程、偏好)
        Returns:
            推荐的妆容列表 (按匹配度排序)
        """
        # 1. 获取候选妆容库
        candidates = self.get_candidates(user_state.occasion)

        # 2. 皮肤条件过滤
        candidates = self.filter_by_skin(candidates, user_state.skin)

        # 3. 计算匹配分数
        scores = []
        for makeup in candidates:
            score = self.calculate_score(makeup, user_state)
            scores.append((makeup, score))

        # 4. 融合潮流热度
        scores = self.blend_trend_score(scores, user_state.trends)

        # 5. 多样性重排序
        results = self.diversity_rerank(scores, top_k=5)

        return results

    def calculate_score(self, makeup: MakeupStyle, user: UserState) -> float:
        """计算妆容匹配分数"""
        score = 0.0

        # 脸型匹配
        score += 0.2 * self.face_shape_match(makeup, user.face_shape)

        # 肤色匹配
        score += 0.2 * self.skin_tone_match(makeup, user.skin_tone)

        # 场合匹配
        score += 0.25 * self.occasion_match(makeup, user.occasion)

        # 情绪匹配
        score += 0.15 * self.mood_match(makeup, user.mood)

        # 个人偏好
        score += 0.2 * self.preference_match(makeup, user.preferences)

        return score
```

### 4.3 潮流追踪系统

#### 4.3.1 数据源

| 平台 | 数据类型 | 抓取频率 |
|------|----------|----------|
| 小红书 | 美妆笔记、标签 | 每小时 |
| 抖音 | 美妆视频、话题 | 每小时 |
| 微博 | 美妆话题、KOL动态 | 每2小时 |
| Instagram | 国际趋势 | 每日 |
| Pinterest | 灵感图片 | 每日 |

#### 4.3.2 潮流分析 Pipeline

```
┌─────────────────────────────────────────────────────────────────┐
│                     潮流分析流水线                               │
└─────────────────────────────────────────────────────────────────┘

  数据采集                 内容理解                  趋势挖掘
      │                      │                        │
      ▼                      ▼                        ▼
┌─────────────┐        ┌─────────────┐        ┌─────────────┐
│ 爬虫系统    │        │ 多模态理解  │        │ 趋势检测    │
│             │        │             │        │             │
│ - 小红书    │        │ - 图像分析  │        │ - 热度曲线  │
│ - 抖音      │ ─────► │ - 视频理解  │ ─────► │ - 上升趋势  │
│ - 微博      │        │ - 文本NLP   │        │ - 周期性    │
│             │        │ - 标签提取  │        │ - 异常检测  │
└─────────────┘        └─────────────┘        └─────────────┘
                                                    │
                                                    ▼
  推荐应用                 趋势预测                趋势聚类
      │                      │                        │
      ▼                      ▼                        ▼
┌─────────────┐        ┌─────────────┐        ┌─────────────┐
│ 个性化推荐  │        │ LSTM 预测   │        │ 主题聚类    │
│             │        │             │        │             │
│ - 热门妆容  │ ◄───── │ - 7天预测   │ ◄───── │ - 妆容风格  │
│ - 必买产品  │        │ - 季节趋势  │        │ - 产品类别  │
│ - 提前囤货  │        │ - 节日热点  │        │ - 色彩趋势  │
│             │        │             │        │             │
└─────────────┘        └─────────────┘        └─────────────┘
```

### 4.4 上下文感知

#### 4.4.1 日历集成

| 事件类型 | 妆容建议 |
|----------|----------|
| 工作会议 | 干练职场妆 |
| 约会 | 甜美/温柔妆 |
| 面试 | 清新自然妆 |
| 生日派对 | 闪亮派对妆 |
| 婚礼 | 高级优雅妆 |
| 运动 | 淡妆/防水妆 |

#### 4.4.2 生理周期适配

| 周期阶段 | 皮肤状态 | 建议 |
|----------|----------|------|
| 经期 (1-7天) | 敏感、暗沉 | 温和护肤、提亮底妆 |
| 滤泡期 (8-14天) | 状态最佳 | 可尝试新妆容 |
| 排卵期 (15-17天) | 油脂分泌增加 | 控油、哑光 |
| 黄体期 (18-28天) | 易长痘 | 遮瑕重点、简洁妆 |

---

## 五、教程生成系统

### 5.1 教程结构

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                          妆容教程结构                                        │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  教程元信息                                                                  │
│                                                                              │
│  - 妆容名称: 温柔约会妆                                                      │
│  - 难度等级: ★★☆☆☆                                                          │
│  - 预计时间: 15分钟                                                          │
│  - 适合场合: 约会、下午茶                                                    │
│  - 适合肤质: 中性、干性                                                      │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────┐
│  步骤详情                                                                    │
│                                                                              │
│  Step 1: 底妆                                                                │
│  ├── 产品: 粉底液 (推荐: XX品牌)                                            │
│  ├── 手法: 从中心向外推开                                                   │
│  ├── 视频: [AR 叠加引导]                                                    │
│  └── 检查点: 确认均匀覆盖                                                   │
│                                                                              │
│  Step 2: 眉毛                                                                │
│  ├── 产品: 眉笔 (推荐: XX品牌)                                              │
│  ├── 手法: 顺着眉毛生长方向                                                 │
│  ├── 视频: [眉形引导线]                                                     │
│  └── 检查点: 对称性检测                                                     │
│                                                                              │
│  Step 3: 眼影                                                                │
│  ├── 产品: 眼影盘 (推荐: XX品牌)                                            │
│  ├── 色号: 浅棕 + 深棕                                                       │
│  ├── 手法: 渐变晕染                                                         │
│  ├── 视频: [眼影范围 AR 标注]                                               │
│  └── 检查点: 左右对称                                                       │
│                                                                              │
│  Step 4: 腮红                                                                │
│  ├── 产品: 腮红 (推荐: XX品牌)                                              │
│  ├── 位置: 苹果肌位置                                                       │
│  ├── 视频: [腮红位置 AR 标注]                                               │
│  └── 检查点: 自然过渡                                                       │
│                                                                              │
│  Step 5: 口红                                                                │
│  ├── 产品: 口红 (推荐: XX品牌)                                              │
│  ├── 色号: 豆沙色                                                           │
│  ├── 手法: 从唇中央向外涂抹                                                 │
│  └── 检查点: 唇线清晰                                                       │
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

### 5.2 AR 辅助

```
┌─────────────────────────────────────────────────────────────────┐
│                       AR 辅助功能                                │
└─────────────────────────────────────────────────────────────────┘

┌───────────────────────────────┐
│                               │
│     ┌─────────────────────┐   │
│     │      AR 眉形引导    │   │  ← 虚线标注理想眉形
│     └─────────────────────┘   │
│                               │
│     ┌─────────────────────┐   │
│     │    AR 眼影范围      │   │  ← 半透明区域标注
│     └─────────────────────┘   │
│                               │
│     ┌─────────────────────┐   │
│     │    AR 腮红位置      │   │  ← 圆形区域标注
│     └─────────────────────┘   │
│                               │
│     ┌─────────────────────┐   │
│     │    AR 修容位置      │   │  ← 阴影区域标注
│     └─────────────────────┘   │
│                               │
└───────────────────────────────┘

技术实现:
- 基于 MediaPipe Face Mesh 468 点
- 实时追踪面部关键点
- OpenGL ES 渲染 AR 叠加层
- 帧率 > 30fps
```

---

## 六、LLM 集成

### 6.1 应用场景

| 场景 | LLM 用途 | 模型选择 |
|------|----------|----------|
| 推荐解释 | 生成个性化推荐理由 | GPT-4 |
| 教程脚本 | 生成步骤文案 | Claude |
| 用户对话 | 美妆问答 | GPT-4 |
| 产品描述 | 生成产品卖点 | Claude |

### 6.2 Prompt 设计

```
## 妆容推荐解释 Prompt

你是一位专业的美妆顾问。请根据以下用户信息，用温暖亲切的语气解释为什么推荐这款妆容。

用户信息:
- 皮肤类型: {skin_type}
- 肤色: {skin_tone}
- 今日场合: {occasion}
- 情绪状态: {mood}
- 当前季节: {season}

推荐妆容: {makeup_name}

请生成 2-3 句推荐理由，要求:
1. 针对用户具体情况
2. 突出妆容的优点
3. 语气亲切自然
4. 控制在 50 字以内
```

### 6.3 多轮对话

```
┌─────────────────────────────────────────────────────────────────┐
│                      对话系统架构                                │
└─────────────────────────────────────────────────────────────────┘

  用户输入                 意图识别                  响应生成
      │                      │                        │
      ▼                      ▼                        ▼
┌─────────────┐        ┌─────────────┐        ┌─────────────┐
│ "我想画一个 │        │ Intent:     │        │ LLM 生成    │
│  约会妆"    │ ─────► │ MAKEUP_REC  │ ─────► │ 推荐 + 解释 │
│             │        │             │        │             │
└─────────────┘        │ Slot:       │        └─────────────┘
                       │ occasion=约会│
                       └─────────────┘

支持的意图:
- MAKEUP_REC: 妆容推荐
- PRODUCT_REC: 产品推荐
- TUTORIAL_REQ: 教程请求
- SKIN_ANALYSIS: 皮肤分析
- GENERAL_QA: 美妆问答
```

---

## 七、模型训练与部署

### 7.1 训练流程

```
┌─────────────────────────────────────────────────────────────────┐
│                      模型训练流水线                              │
└─────────────────────────────────────────────────────────────────┘

  数据准备                 模型训练                  模型部署
      │                      │                        │
      ▼                      ▼                        ▼
┌─────────────┐        ┌─────────────┐        ┌─────────────┐
│ 数据采集    │        │ 分布式训练  │        │ 模型转换    │
│             │        │             │        │             │
│ - 标注      │ ─────► │ - PyTorch  │ ─────► │ - ONNX      │
│ - 清洗      │        │ - A100 GPU │        │ - RKNN      │
│ - 增强      │        │ - MLflow   │        │ - TFLite    │
│             │        │             │        │             │
└─────────────┘        └─────────────┘        └─────────────┘
                                                    │
                                                    ▼
                                              ┌─────────────┐
                                              │ 模型测试    │
                                              │             │
                                              │ - 精度验证  │
                                              │ - 速度测试  │
                                              │ - A/B 测试  │
                                              │             │
                                              └─────────────┘
```

### 7.2 部署策略

| 模型 | 边缘部署 | 云端部署 | 更新频率 |
|------|----------|----------|----------|
| 人脸检测 | ✓ (RKNN) | - | 季度 |
| 皮肤分析 | 轻量版 | 完整版 | 月度 |
| 推荐模型 | - | ✓ (GPU) | 周度 |
| LLM | - | ✓ (API) | - |

---

*AI 系统设计遵循: 准确性、实时性、个性化原则*
