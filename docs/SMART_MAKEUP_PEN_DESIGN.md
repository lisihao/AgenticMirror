# 智能化妆笔系统设计文档

> 版本: 1.0.0 | 日期: 2025-01-19

## 一、需求概述

### 1.1 背景

AgenticMirror 智能美妆镜配套的硬件产品线需要包含智能化妆工具。参考 Apple Pencil 和 Samsung S Pen 的设计理念，我们设计一系列智能化妆笔，具有可替换笔头和智能传感功能。

### 1.2 产品定位

**智能化妆笔系列** = 专业化妆工具 + 智能传感器 + AI 辅助

核心价值：
- **精准**：传感器辅助定位和力度控制
- **智能**：AI 实时指导和建议
- **互联**：与智能镜无缝协作
- **专业**：可替换专业笔头

### 1.3 需求列表

| 需求ID | 需求描述 | 优先级 |
|--------|----------|--------|
| SMP-01 | 设计 6 种智能化妆笔（粉底/眉笔/眼影/腮红/唇釉/修容） | P0 |
| SMP-02 | 每种笔具有专属可替换笔头 | P0 |
| SMP-03 | 每种笔具有 3+ 智能功能 | P0 |
| SMP-04 | 在技术演示页实现交互式画笔绘制 | P0 |
| SMP-05 | 显示智能功能说明面板 | P1 |
| SMP-06 | 笔身 LED 状态指示 | P1 |

### 1.4 用户故事

- 作为用户，我希望化妆笔能感知我的下笔力度，自动调整上妆浓度
- 作为用户，我希望眉笔能帮我画出对称的眉毛
- 作为用户，我希望粉底笔能扫描我的肤色，推荐最佳色号
- 作为用户，我希望腮红刷能告诉我苹果肌的准确位置

## 二、技术方案

### 2.1 硬件设计概念

#### 2.1.1 笔身结构

```
┌─────────────────────────────────────┐
│  ● LED 指示灯                        │
│  ══════════════════════════════════ │
│  │        笔身主体                 │ │
│  │   • 压感传感器                  │ │
│  │   • 陀螺仪/加速度计             │ │
│  │   • 蓝牙模块                    │ │
│  │   • 锂电池                      │ │
│  ══════════════════════════════════ │
│  ╲                                ╱  │
│   ╲   可替换笔头接口            ╱   │
│    ╲════════════════════════╱    │
│          笔头（消耗品）              │
└─────────────────────────────────────┘
```

#### 2.1.2 传感器配置

| 传感器 | 功能 | 应用场景 |
|--------|------|----------|
| 压力传感器 | 检测下笔力度 | 控制上妆浓淡 |
| 6 轴陀螺仪 | 检测笔身角度 | 眉笔最佳角度提示 |
| RGB 颜色传感器 | 扫描肤色/妆容颜色 | 色号匹配推荐 |
| 红外接近传感器 | 检测与皮肤距离 | 触肤检测 |
| 霍尔传感器 | 检测笔头类型 | 自动识别安装的笔头 |

### 2.2 软件交互设计

#### 2.2.1 技术演示架构

```
FaceTouchDemo Component
├── State Management
│   ├── selectedPen (当前选中的笔)
│   ├── brushPos (画笔位置)
│   ├── isDrawing (是否正在绘制)
│   ├── strokes (笔迹数组)
│   └── makeup (已上妆区域)
├── SVG Canvas
│   ├── Face Rendering (人脸渲染)
│   ├── Makeup Layers (妆容层)
│   ├── Stroke Rendering (笔迹渲染)
│   └── Brush Cursor (画笔光标)
├── Pen Selector (笔选择器)
└── Info Panel (信息面板)
    ├── Current Pen Info (当前笔信息)
    ├── Smart Features (智能功能)
    └── Applied Makeup (已上妆)
```

#### 2.2.2 数据结构

```typescript
interface SmartPen {
  id: string;           // 唯一标识
  name: string;         // 中文名称
  icon: string;         // 图标 emoji
  head: string;         // 笔头类型
  color: string;        // 代表色
  smartFeatures: string[]; // 智能功能列表
}

interface Stroke {
  x: number;
  y: number;
  color: string;
  size: number;
}

interface MakeupState {
  foundation: boolean;
  eyebrow: boolean;
  eyeshadow: boolean;
  blush: boolean;
  lips: boolean;
  contour: boolean;
}
```

## 三、详细设计

### 3.1 智能化妆笔产品线

#### 3.1.1 智能粉底笔

| 属性 | 值 |
|------|-----|
| 名称 | 智能粉底笔 |
| 笔头 | 海绵头（可替换） |
| 颜色 | #fdd5c0 |
| **智能功能** | |
| 1 | **压感检测**：轻压薄涂，重压遮瑕 |
| 2 | **肤色扫描**：自动匹配最佳色号 |
| 3 | **用量提醒**：剩余量实时显示 |

#### 3.1.2 智能眉笔

| 属性 | 值 |
|------|-----|
| 名称 | 智能眉笔 |
| 笔头 | 斜角笔头（可替换） |
| 颜色 | #4a3728 |
| **智能功能** | |
| 1 | **角度感应**：45° 最佳上妆角度提示 |
| 2 | **眉形导航**：根据脸型推荐眉形 |
| 3 | **对称辅助**：左右眉毛对称度检测 |

#### 3.1.3 智能眼影刷

| 属性 | 值 |
|------|-----|
| 名称 | 智能眼影刷 |
| 笔头 | 晕染刷头（可替换） |
| 颜色 | #a855f7 |
| **智能功能** | |
| 1 | **区域识别**：眼窝/眼尾智能分区 |
| 2 | **晕染指导**：震动提示晕染方向 |
| 3 | **配色推荐**：根据肤色推荐眼影盘 |

#### 3.1.4 智能腮红刷

| 属性 | 值 |
|------|-----|
| 名称 | 智能腮红刷 |
| 笔头 | 散粉刷头（可替换） |
| 颜色 | #f472b6 |
| **智能功能** | |
| 1 | **位置定位**：苹果肌精准定位 |
| 2 | **力度反馈**：下手轻重实时提示 |
| 3 | **范围控制**：防止腮红画太大 |

#### 3.1.5 智能唇釉笔

| 属性 | 值 |
|------|-----|
| 名称 | 智能唇釉笔 |
| 笔头 | 唇刷头（可替换） |
| 颜色 | #e11d48 |
| **智能功能** | |
| 1 | **唇线勾勒**：自动识别唇线边缘 |
| 2 | **颜色试色**：AR 预览不同色号 |
| 3 | **持妆检测**：提醒补妆时机 |

#### 3.1.6 智能修容笔

| 属性 | 值 |
|------|-----|
| 名称 | 智能修容笔 |
| 笔头 | 斜角刷头（可替换） |
| 颜色 | #92400e |
| **智能功能** | |
| 1 | **脸型分析**：推荐修容位置 |
| 2 | **阴影导航**：高光/阴影区域提示 |
| 3 | **晕染检测**：边缘是否自然 |

### 3.2 面部区域映射

为了配合智能化妆笔的使用，定义了 9 个面部区域：

| 区域ID | 名称 | 全称 | 化妆建议 |
|--------|------|------|----------|
| tzone | T区 | T型区（额头+鼻子） | 控油底妆、定妆散粉、鼻梁高光 |
| forehead | 额头 | 额头区域 | 遮盖抬头纹、发际线晕染、眉骨高光 |
| eyebrow | 眉毛 | 眉毛区域 | 眉形选择、眉头淡眉尾深、眉刷晕染 |
| eyeshadow | 眼部 | 眼周区域 | 眼影打底、浅提亮深加深、眼尾上扬 |
| nose | 鼻子 | 鼻部区域 | 山根阴影、鼻头修容、鼻梁高光 |
| blush | 脸颊 | 苹果肌区域 | 微笑找位置、斜扫显脸小、配色口红 |
| uzone | U区 | U型区（两颊+下巴） | 保湿、颧骨修容、下颌线修容 |
| lips | 嘴唇 | 唇部区域 | 润唇打底、唇线勾勒、咬唇妆 |
| chin | 下巴 | 下巴区域 | 下巴高光、V脸修容、脖子衔接 |

### 3.3 交互实现

#### 3.3.1 画笔光标

```typescript
// SVG 画笔光标
<g transform={`translate(${brushPos.x}, ${brushPos.y})`}>
  {/* 笔身 */}
  <rect x="-3" y="-35" width="6" height="30" rx="2"
        fill="linear-gradient(180deg, #4a4a4a, #2a2a2a)" />
  {/* 笔头 */}
  <path d="M -4 -5 L 0 5 L 4 -5 Z" fill={selectedPen.color} />
  {/* 智能指示灯 */}
  <motion.circle cx="0" cy="-30" r="2" fill="#22c55e"
                 animate={{ opacity: [1, 0.3, 1] }}
                 transition={{ duration: 1, repeat: Infinity }} />
  {/* 压感指示 */}
  {isDrawing && (
    <motion.circle cx="0" cy="0" r="8"
                   fill="none" stroke={selectedPen.color}
                   initial={{ scale: 0.5, opacity: 1 }}
                   animate={{ scale: 1.5, opacity: 0 }}
                   transition={{ duration: 0.5, repeat: Infinity }} />
  )}
</g>
```

#### 3.3.2 绘制逻辑

```typescript
const handleMouseMove = (e: React.MouseEvent<SVGSVGElement>) => {
  // 计算相对于 SVG 的坐标
  const rect = svgRef.current.getBoundingClientRect();
  const x = ((e.clientX - rect.left) / rect.width) * 200;
  const y = ((e.clientY - rect.top) / rect.height) * 260;
  setBrushPos({ x, y });

  // 如果正在绘制且在有效区域内，添加笔迹
  if (isDrawing && x > 30 && x < 170 && y > 30 && y < 230) {
    setStrokes(prev => [
      ...prev.slice(-100),  // 保留最近 100 个笔迹点
      {
        x, y,
        color: selectedPen.color,
        size: 3 + Math.random() * 2  // 随机笔迹大小模拟自然感
      }
    ]);
  }
};
```

#### 3.3.3 笔迹渲染

```typescript
{strokes.map((stroke, i) => (
  <circle
    key={i}
    cx={stroke.x}
    cy={stroke.y}
    r={stroke.size}
    fill={stroke.color}
    opacity="0.6"
    filter="url(#strokeBlur)"
  />
))}
```

### 3.4 UI 布局

```
┌─────────────────────────────────────────────────────────────┐
│  [🖌️ 智能粉底笔] [✏️ 智能眉笔] [🎨 眼影刷] [🌸 腮红刷] ...   │  ← 笔选择器
├────────────────────────────────────┬────────────────────────┤
│                                    │  ┌──────────────────┐  │
│                                    │  │   🖌️             │  │
│          SVG 绘制区域               │  │  智能粉底笔      │  │
│         （人脸 + 画笔）             │  │  笔头：海绵头    │  │
│                                    │  ├──────────────────┤  │
│                                    │  │ 智能功能：       │  │
│                                    │  │ ⚡ 压感检测...   │  │
│                                    │  │ ⚡ 肤色扫描...   │  │
│                                    │  │ ⚡ 用量提醒...   │  │
│                                    │  ├──────────────────┤  │
│                                    │  │ 已上妆：         │  │
│     按住鼠标在脸上绘制              │  │ [底妆] [眉毛]   │  │
│                                    │  ├──────────────────┤  │
│                                    │  │ [  卸妆重置  ]   │  │
│                                    │  └──────────────────┘  │
└────────────────────────────────────┴────────────────────────┘
```

## 四、实现计划

### 4.1 已完成功能

| 功能 | 状态 | 提交 |
|------|------|------|
| 6 种智能化妆笔数据定义 | ✅ 完成 | feat: Smart makeup pen system |
| 笔选择器 UI | ✅ 完成 | feat: Smart makeup pen system |
| SVG 画笔光标 | ✅ 完成 | feat: Smart makeup pen system |
| 绘制逻辑和笔迹渲染 | ✅ 完成 | feat: Smart makeup pen system |
| 智能功能面板 | ✅ 完成 | feat: Smart makeup pen system |
| 已上妆状态显示 | ✅ 完成 | feat: Smart makeup pen system |
| LED 指示灯动画 | ✅ 完成 | feat: Smart makeup pen system |
| 压感指示动画 | ✅ 完成 | feat: Smart makeup pen system |
| 卸妆重置功能 | ✅ 完成 | feat: Smart makeup pen system |

### 4.2 文件清单

| 文件 | 说明 |
|------|------|
| `web/frontend/app/demo/technology/page.tsx` | FaceTouchDemo 组件 |

## 五、商业化考量

### 5.1 产品定价建议

| 产品 | 建议零售价 | 备注 |
|------|------------|------|
| 智能化妆笔单支 | ¥299-399 | 含 1 个笔头 |
| 智能化妆笔套装（6支） | ¥1,499 | 含所有笔头 |
| 替换笔头（3个装） | ¥59-89 | 消耗品 |

### 5.2 消耗品策略

智能化妆笔的笔头为消耗品，建议更换周期：
- 海绵头：每月更换
- 刷毛类：每 3 个月更换
- 笔芯类（眉笔/唇笔）：用完即换

### 5.3 与智能镜联动

1. **自动识别**：笔靠近镜子时自动连接
2. **同步教程**：镜子显示对应化妆教程
3. **实时反馈**：镜子显示压力/角度数据
4. **历史记录**：记录每次化妆使用的产品

## 六、后续优化方向

1. 添加更多笔类型（遮瑕笔、眼线笔、睫毛膏等）
2. 支持自定义笔头颜色
3. 添加笔身颜色/材质选择
4. 支持笔迹撤销/重做
5. 添加化妆教程引导模式
6. 支持导出妆容方案
